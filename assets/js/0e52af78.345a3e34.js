"use strict";(self.webpackChunkwaxdevelopers=self.webpackChunkwaxdevelopers||[]).push([[2355],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=l(n),d=o,h=u["".concat(p,".").concat(d)]||u[d]||m[d]||r;return n?a.createElement(h,s(s({ref:t},c),{},{components:n})):a.createElement(h,s({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=d;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[u]="string"==typeof e?e:o,s[1]=i;for(var l=2;l<r;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8760:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>m,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var a=n(7462),o=(n(7294),n(3905));const r={title:"How to Set Up a WAX Atomic API Node",nav_order:4,layout:"default",parent:"Atomic Assets","lang-href":"How to Set Up a WAX Atomic API Node",lang:"en"},s=void 0,i={unversionedId:"atomic-assets/setup-wax-atomic-api-node",id:"atomic-assets/setup-wax-atomic-api-node",title:"How to Set Up a WAX Atomic API Node",description:"The AtomicAssets NFT standard developed by  Pink.gg  has become synonymous with the WAX Protocol Network and the widely utilised  WAX Atomic Hub.",source:"@site/docs/atomic-assets/setup-wax-atomic-api-node.md",sourceDirName:"atomic-assets",slug:"/atomic-assets/setup-wax-atomic-api-node",permalink:"/waxdevelopers_test/docs/atomic-assets/setup-wax-atomic-api-node",draft:!1,editUrl:"https://github.com/3dkrender/waxdeveloper_test/tree/main/docs/atomic-assets/setup-wax-atomic-api-node.md",tags:[],version:"current",frontMatter:{title:"How to Set Up a WAX Atomic API Node",nav_order:4,layout:"default",parent:"Atomic Assets","lang-href":"How to Set Up a WAX Atomic API Node",lang:"en"},sidebar:"tutorialSidebar",previous:{title:"Optimise & Restore a WAX Atomic API Node",permalink:"/waxdevelopers_test/docs/atomic-assets/optimise-restore-wax-atomic-api-node"},next:{title:"dApp Development",permalink:"/waxdevelopers_test/docs/dapp-development/"}},p={},l=[{value:"Application Installation and Configuration Process",id:"application-installation-and-configuration-process",level:2},{value:"Atomic API",id:"atomic-api",level:2},{value:"Start/Stop the Atomic API Service",id:"startstop-the-atomic-api-service",level:2}],c={toc:l},u="wrapper";function m(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"The AtomicAssets NFT standard developed by  ",(0,o.kt)("a",{parentName:"p",href:"https://pink.gg/"},"Pink.gg"),"  has become synonymous with the WAX Protocol Network and the widely utilised  ",(0,o.kt)("a",{parentName:"p",href:"https://wax.atomichub.io/"},"WAX Atomic Hub"),"."),(0,o.kt)("p",null,"The AtomicAssets NFT standard stands apart from it\u2019s alternatives by not requiring any RAM from users and offering native two sided trade offers as well as backing NFTs with tokens. You can read more about the standard at  ",(0,o.kt)("a",{parentName:"p",href:"https://atomicassets.io/"},"https://atomicassets.io/"),"."),(0,o.kt)("p",null,"Of course no awesome NFT framework would be complete without the ability for users and developers to access real-time data in a simple and effective way through a scalable API. This is where  ",(0,o.kt)("a",{parentName:"p",href:"https://pink.gg/"},"Pink.gg"),"  developed the e",(0,o.kt)("a",{parentName:"p",href:"https://github.com/pinknetworkx/eosio-contract-api"},"osio-contract-api")," also known as the  ",(0,o.kt)("strong",{parentName:"p"},"Atomic API"),"."),(0,o.kt)("p",null,"This guide will walk through the process of building and running a WAX Atomic API Node enabling you as a Guild or Developer to offer a very useful API service for the ecosystem\u2026 or maybe just for you."),(0,o.kt)("h1",{id:"how-to-set-up-a-wax-atomic-api-node"},"How to Set Up a WAX Atomic API Node"),(0,o.kt)("p",null,"Public Atomic API nodes are extremely utilised on the WAX Mainnet and are used by users and DApps to query state and history of atomicassets and the atomicmarket."),(0,o.kt)("p",null,"A solid mainnet node may be run in docker if you wish to containerise the instance or via PM2 if you prefer to run it at the system level."),(0,o.kt)("p",null,"This guide goes through the process of building the application dependencies and running the node with PM2."),(0,o.kt)("h1",{id:"mainnet-requirements"},"Mainnet Requirements"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Hardware")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"8 Core CPU / 5",(0,o.kt)("em",{parentName:"li"},"Ghz+ recommended")),(0,o.kt)("li",{parentName:"ul"},"1TB+ Disk /  ",(0,o.kt)("em",{parentName:"li"},"Enterprise Grade SSD or NVMe"))),(0,o.kt)("p",null,"Currently (November 2022) a complete node uses approximately  ",(0,o.kt)("strong",{parentName:"p"},"859GB"),"  of Disk space with the postgres DB currently  ",(0,o.kt)("strong",{parentName:"p"},"849GB"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"64GB+ RAM")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Operating System")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Ubuntu 20.04  ",(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("em",{parentName:"strong"},"(Recommended)")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"SHIP Node")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Access to an up to date v2.0.12\u201313 or v3.1.x WAX State-History node"),(0,o.kt)("li",{parentName:"ul"},"SHIP node on the same LAN  ",(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("em",{parentName:"strong"},"(Highly Recommended)")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Network")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Modern Internet Broadband / Fibre Connection (100Mb/s synchronous and above)"),(0,o.kt)("li",{parentName:"ul"},"1Gb/s+ LAN")),(0,o.kt)("h1",{id:"build-the-software"},"Build the Software"),(0,o.kt)("p",null,"At time of writing the current version of the  ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/pinknetworkx/eosio-contract-api"},"eosio-contract-api"),"  is  ",(0,o.kt)("inlineCode",{parentName:"p"},"v1.3.17")),(0,o.kt)("p",null,"Application Dependencies ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"(Some our our recommendations)"))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"NodeJS >= 16.0"),(0,o.kt)("li",{parentName:"ul"},"PM2"),(0,o.kt)("li",{parentName:"ul"},"PostgreSQL >= 14.0"),(0,o.kt)("li",{parentName:"ul"},"Redis >= 5.0"),(0,o.kt)("li",{parentName:"ul"},"Yarn")),(0,o.kt)("h2",{id:"application-installation-and-configuration-process"},"Application Installation and Configuration Process"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"NodeJS")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"> curl -fsSL [https://deb.nodesource.com/setup_16.x](https://deb.nodesource.com/setup_16.x) | sudo -E bash -> sudo apt install -y nodejs\n\n#Check Version#  \n> node -v\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"PM2")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"> sudo npm install pm2 -g\n\n#Check Version#  \n> pm2 -v\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Postgres")),(0,o.kt)("p",null,"Install Postgres as below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"> sudo apt-get install wget ca-certificates\n\n> wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -\n\n> sudo sh -c 'echo \"deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main\" > /etc/apt/sources.list.d/pgdg.list'\n\n> sudo apt update\n\n> sudo apt install postgresql postgresql-contrib\n\n#Check Version#  \n> apt show postgresql\n")),(0,o.kt)("p",null,"After installation a new database needs to be created and permissions assigned if necessary, this example will use the default postgres user."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'> sudo su - postgres\n\n> psql\n\n#Assign a password to the postgres account#  \npostgres=# \\password  \nEnter new password:  \nEnter it again:\n\n#Create the database#  \npostgres=# \\l (lists databases)\npostgres=# CREATE DATABASE "api-wax-mainnet-atomic-1";\npostgres=# \\l+ (lists databases - including size)\npostgres=# \\q (quit)\n\n> exit\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Redis")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'> curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg\n\n> echo "deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/redis.list\n\n> sudo apt update\n\n> sudo apt install redis\n\n#Check Version#  \n> redis-server --version\n\n#If there is a unmask error then#  \n> sudo systemctl unmask redis-server.service\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Yarn")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"> sudo npm install --global yarn\n\n#Check Version#  \n> yarn --version\n")),(0,o.kt)("h2",{id:"atomic-api"},"Atomic API"),(0,o.kt)("p",null,"The latest building instructions can always be found at the  ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/pinknetworkx/eosio-contract-api"},"Pink.gg Github")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Installation")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"> git clone https://github.com/pinknetworkx/eosio-contract-api.git\n\n> cd eosio-contract-api\n\n> yarn install\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Configuration")),(0,o.kt)("p",null,"There are three configuration files to be adjusted for your specific deployment"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"connections.config.json  \nserver.config.json  \nreaders.config.json\n")),(0,o.kt)("p",null,"Below are basic configurations for this example please tailor to your own deployment:"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"connections.config.json")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'> cd  ~/eosio-contract-api/config\n\n> cp example-connections.config.json connections.config.json\n\n> nano connections.config.json\n{\n  "postgres": {\n    "host": "127.0.0.1",\n    "port": 5432,\n    "user": "postgres",\n    "password": "YOUR POSGRESS PASSWORD",\n    "database": "api-wax-mainnet-atomic-1"\n  },\n  "redis": {\n    "host": "127.0.0.1",\n    "port": 6379\n  },\n  "chain": {\n    "name": "wax-mainnet",\n    "chain_id": "1064487b3cd1a897ce03ae5b6a865651747e2e152090f99c1d19d44e01aea5a4",\n    "http": "http://10.0.0.65:8888",\n    "ship": "ws://10.0.0.65:8080"\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"server.config.json")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'> cd  ~/eosio-contract-api/config\n\n> cp example-server.config.json server.config.json\n\n> nano server.config.json\n{\n  "provider_name": "EOSphere Guild",\n  "provider_url": "https://eosphere.io",\n"server_addr": "0.0.0.0",\n  "server_name": "wax-atomic-api.eosphere.io",\n  "server_port": 9000,\n"cache_life": 5,\n  "trust_proxy": true,\n"rate_limit": {\n    "interval": 60,\n    "requests": 240,\n    "bill_execution_time": true\n  },\n"ip_whitelist": [],\n  "slow_query_threshold": 7500,\n"max_query_time_ms": 10000,\n  "max_db_connections": 50,\n"namespaces": [\n    {\n      "name": "atomicassets",\n      "path": "/atomicassets",\n      "args": {\n        "atomicassets_account": "atomicassets",\n        "connected_reader": "atomic-1",\n        "socket_features": {\n          "asset_update": false\n        }\n      }\n    },\n    {\n      "name": "atomicmarket",\n      "path": "/atomicmarket",\n      "args": {\n        "atomicmarket_account": "atomicmarket",\n        "connected_reader": "atomic-1",\n        "socket_features": {\n          "asset_update": false\n        },\n       "api_features": {\n          "disable_v1_sales": true\n        }\n      }\n    },\n    {\n      "name": "atomictools",\n      "path": "/atomictools",\n      "args": {\n        "atomictools_account": "atomictoolsx",\n        "atomicassets_account": "atomicassets",\n        "connected_reader": "atomic-1"\n      }\n    }\n  ]\n}\n')),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"readers.config.json")),(0,o.kt)("p",null,"Advice from the Pink team was that indexing only needs to start from block 64000000"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'> cd  ~/eosio-contract-api/config\n\n> cp example-readers.config.json readers.config.json\n\n> nano readers.config.json\n[\n  {\n    "name": "atomic-1",\n"server_addr": "0.0.0.0",\n    "server_port": 9001,\n"start_block": 64000000,\n    "stop_block": 0,\n    "irreversible_only": false,\n"ship_prefetch_blocks": 50,\n    "ship_min_block_confirmation": 30,\n    "ship_ds_queue_size": 20,\n"db_group_blocks": 10,\n"ds_ship_threads": 4,\n"modules": [],\n"contracts": [\n      {\n        "handler": "atomicassets",\n        "args": {\n          "atomicassets_account": "atomicassets",\n          "store_transfers": true,\n          "store_logs": true\n        }\n      },\n      {\n        "handler": "delphioracle",\n        "args": {\n          "delphioracle_account": "delphioracle"\n        }\n      },\n      {\n        "handler": "atomicmarket",\n        "args": {\n          "atomicmarket_account": "atomicmarket",\n          "store_logs": true\n        }\n      },\n      {\n        "handler": "atomictools",\n        "args": {\n          "atomictools_account": "atomictoolsx",\n          "store_logs": true\n        }\n      }\n    ]\n  }\n]\n')),(0,o.kt)("h2",{id:"startstop-the-atomic-api-service"},"Start/Stop the Atomic API Service"),(0,o.kt)("p",null,"In this example the Atomic API Service will start indexing from block 64000000 and will build a fresh postgres database to the current headblock."),(0,o.kt)("p",null,"This will take sometime and it is advisable to ensure indexing has caught up before you start offering the API publicly."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"> cd ~/eosio-contract-api\n\n#Start Postgres Indexing Filler#  \n> pm2 start ecosystems.config.json --only eosio-contract-api-filler\n\n#Start the API Server#  \n> pm2 start ecosystems.config.json --only eosio-contract-api-server\n\n#Monitor Filler and Server#  \n> pm2 log\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"NB:"))," ",(0,o.kt)("em",{parentName:"p"},"Stopping the filler service can occasionally be problematic where restarting too soon can cause two instances of the filler to run causing a DB corruption. To get around this ensure that the filler has in fact stopped indexing to postgres by monitoring the active services with top or htop before you restart.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"#Stop Postgres Indexing Filler#  \n> pm2 stop eosio-contract-api-filler\n\n#Stop the API Server#  \n> pm2 stop eosio-contract-api-server\n\n#Stop All#  \n> pm2 stop all\n\n#Check using top or htop#\n")),(0,o.kt)("p",null,"Your node will be accessible via  ",(0,o.kt)("strong",{parentName:"p"},"http port 9000"),"  which when offering the service publicly will be best served from behind a SSL offloading loadbalancer such as HAProxy or nginx."),(0,o.kt)("p",null,"Query your node\u2019s status as below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"> curl http://x.x.x.x:9000/health\n> curl http://x.x.x.x:9000/atomicassets/v1/config\n> curl http://x.x.x.x:9000/atomicmarket/v1/config\n> curl https://x.x.x.x:9000/atomictools/v1/config\n")),(0,o.kt)("hr",null),(0,o.kt)("p",null,"These ",(0,o.kt)("strong",{parentName:"p"},"WAX Developer Technical Guides")," are created using source material from the ",(0,o.kt)("a",{parentName:"p",href:"https://medium.com/eosphere/wax-technical-how-to/home"},"EOSphere WAX Technical How To Series")),(0,o.kt)("p",null,"Be sure to ask any questions in the  ",(0,o.kt)("a",{parentName:"p",href:"https://t.me/eosphere_io"},"EOSphere Telegram")))}m.isMDXComponent=!0}}]);