"use strict";(self.webpackChunkwaxdevelopers=self.webpackChunkwaxdevelopers||[]).push([[7052],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(n),h=o,f=c["".concat(l,".").concat(h)]||c[h]||d[h]||s;return n?a.createElement(f,r(r({ref:t},u),{},{components:n})):a.createElement(f,r({ref:t},u))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,r=new Array(s);r[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[c]="string"==typeof e?e:o,r[1]=i;for(var p=2;p<s;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8618:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var a=n(7462),o=(n(7294),n(3905));const s={title:"Using WAX Snapshots",nav_order:143,layout:"default",parent:"WAX Infrastructure Guides","lang-ref":"Using WAX Snapshots",lang:"en"},r=void 0,i={unversionedId:"wax-infrastructure/wax-snapshots",id:"wax-infrastructure/wax-snapshots",title:"Using WAX Snapshots",description:"You will have noticed that syncing up to a blockchain that has been running for millions of blocks can take quite some time. Luckily Syncing up can be expedited by using an existing valid snapshot of the chain state database.",source:"@site/docs/wax-infrastructure/wax-snapshots.md",sourceDirName:"wax-infrastructure",slug:"/wax-infrastructure/wax-snapshots",permalink:"/waxdevelopers_test/docs/wax-infrastructure/wax-snapshots",draft:!1,editUrl:"https://github.com/wax-office-of-inspector-general/wax-developer/tree/main/docs/wax-infrastructure/wax-snapshots.md",tags:[],version:"current",frontMatter:{title:"Using WAX Snapshots",nav_order:143,layout:"default",parent:"WAX Infrastructure Guides","lang-ref":"Using WAX Snapshots",lang:"en"},sidebar:"tutorialSidebar",previous:{title:"How to Set Up a WAX State-History Node",permalink:"/waxdevelopers_test/docs/wax-infrastructure/wax-mainnet-ship-node"},next:{title:"Set Up a WAX Testnet Block Producer Node",permalink:"/waxdevelopers_test/docs/wax-infrastructure/wax-testnet-block-producer"}},l={},p=[{value:"How to use WAX Snapshots",id:"how-to-use-wax-snapshots",level:2},{value:"Explanation",id:"explanation",level:3},{value:"Locating a snapshot",id:"locating-a-snapshot",level:3},{value:"Usage",id:"usage",level:3},{value:"Generating snapshots",id:"generating-snapshots",level:3}],u={toc:p},c="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(c,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"You will have noticed that syncing up to a blockchain that has been running for millions of blocks can take quite some time. Luckily Syncing up can be expedited by using an existing valid snapshot of the chain state database."),(0,o.kt)("p",null,"In this Article you will learn how to make use of snapshots as well as how to create them yourself."),(0,o.kt)("h2",{id:"how-to-use-wax-snapshots"},"How to use WAX Snapshots"),(0,o.kt)("p",null,"A valid snapshot can be used to sync a WAX ",(0,o.kt)("inlineCode",{parentName:"p"},"nodeos")," process up to a desired block on launch by using a snapshot file to recreate a valid chain state database."),(0,o.kt)("p",null,"This alleviates the need to build the state database one block at a time from block #1, which takes time to catch up to the chain head block which can be in the millions or more."),(0,o.kt)("h3",{id:"explanation"},"Explanation"),(0,o.kt)("p",null,"The chain state database ",(0,o.kt)("inlineCode",{parentName:"p"},"shared_memory.bin")," is needed by ",(0,o.kt)("inlineCode",{parentName:"p"},"nodeos")," to run, it is a memory mapped file that contains the state associated with each block, including smart contract data, account details and deferred transactions."),(0,o.kt)("p",null,"There is however a caveat. Depending on the function you require of your node, for instance running it as a P2P seed node or fully functional API node you will also require the associated complete ",(0,o.kt)("inlineCode",{parentName:"p"},"blocks.log")," from block #1 to be able to provide the \u201cfull\u201d chain."),(0,o.kt)("p",null,"It should also be mentioned that the now depreciated V1 History functionality is not preserved in a snapshot and will required a full replay."),(0,o.kt)("p",null,"It is possible to run ",(0,o.kt)("inlineCode",{parentName:"p"},"nodeos")," without any ",(0,o.kt)("inlineCode",{parentName:"p"},"blocks.log")," with a current snapshot file but this node wouldn\u2019t be considered \u201cfull\u201d and would typically only be used to query current chain info and push actions."),(0,o.kt)("p",null,"Ideally snapshots should be used with an associated ",(0,o.kt)("inlineCode",{parentName:"p"},"blocks.log")," containing a higher head block number. So lower block in snapshot. higher block in ",(0,o.kt)("inlineCode",{parentName:"p"},"blocks.log")," when you start ",(0,o.kt)("inlineCode",{parentName:"p"},"nodeos"),"."),(0,o.kt)("p",null,"Common Scenario\nThe most common use for a snapshot is recovering from an incorrectly stopped node.. power failure, out of memory, process killed etc."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"nodeos")," needs to be gracefully exited otherwise the state database may be corrupted showing this nasty error:"),(0,o.kt)("p",null,"\u201cDatabase dirty flag set (likely due to unclean shutdown): replay required\u201d"),(0,o.kt)("h3",{id:"locating-a-snapshot"},"Locating a snapshot"),(0,o.kt)("p",null,"First of all you need to obtain a valid snapshot file from a trusted source. There are quite a few WAX snapshot services being provided by the WAX Guilds including ",(0,o.kt)("a",{parentName:"p",href:"https://snapshots.eosphere.io/"},"EOSphere"),", however not all provide testnet snapshots.. so you may need to look around a bit."),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://validate.eosnation.io/wax/reports/resources.html#chain"},"EOS Nation bp.json Validator")," has a very handy snapshot service list collated from what the Guilds have advertised.\n:::"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/12730423/187578145-07ba4f0d-8532-4a46-9e47-83347d5793a9.png",alt:"image"})),(0,o.kt)("h3",{id:"usage"},"Usage"),(0,o.kt)("p",null,"Using the example ",(0,o.kt)("inlineCode",{parentName:"p"},"nodeos")," build in the ",(0,o.kt)("a",{parentName:"p",href:"/docs/wax-infrastructure/wax-testnet-node"},"previous")," WAX Technical How To, all relevant files are located in ",(0,o.kt)("inlineCode",{parentName:"p"},"~/waxdata"),"."),(0,o.kt)("p",null,"Download and unarchive the desired snapshot file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"sudo apt install zstd\ncd ~/waxdata/snapshots\nwget http://snapshots.eosphere.io/snapshots/wax/snapshot.bin.zst\nunzstd snapshot.bin.zst\n")),(0,o.kt)("p",null,"Delete the existing (if any) state database and blocks reversible:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"rm -r ~/waxdata/state\nrm -r ~/waxdata/blocks/reversible\n")),(0,o.kt)("p",null,"Launch ",(0,o.kt)("inlineCode",{parentName:"p"},"nodeos")," from the downloaded snapshot (noting that the genesis.json is not specified):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"nodeos --data-dir ~/waxdata --config-dir ~/waxdata --snapshot ~/waxdata/snapshots/snapshot.bin\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"nodeos")," will now start from a snapshot and attempt to sync to the active chain from the head block captured in the used snapshot file. The ",(0,o.kt)("inlineCode",{parentName:"p"},"blocks.log")," will also be continued from the snapshot block number, that is why it is important to ensure a lower block in the snapshot. higher block in ",(0,o.kt)("inlineCode",{parentName:"p"},"blocks.log")," to avoid gaps."),(0,o.kt)("h3",{id:"generating-snapshots"},"Generating snapshots"),(0,o.kt)("p",null,"The most security conscious way of using snapshots is to create and use your own. Perhaps even provide a snapshot file hosting service for the rest of the WAX ecosystem to make use of."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"nodoes")," requires a producer api plugin configured to enable snapshot generation. Add the following to the end of your ",(0,o.kt)("inlineCode",{parentName:"p"},"config.ini"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ini"},"plugin = eosio::producer_api_plugin\n")),(0,o.kt)("p",null,"Warning: Exposing the producer_api_plugin publicly is a security risk and can be exploited, the node used for creating a snapshot should not be publicly queriable.\n:::"),(0,o.kt)("p",null,"Generate a snapshot locally using the following syntax, the snapshot file will by default be saved to the snapshots folder:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"curl -X POST http://127.0.0.1:8888/v1/producer/create_snapshot\n")))}d.isMDXComponent=!0}}]);